<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>72 Angelic Ladder -- Codex 144:99</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="The 72 Shem ha-Mephorash angels as tones, colors, and stylepacks. Click to activate their resonance." />

  <!-- paths from /main/ are correct like this -->
  <link rel="stylesheet" href="../assets/css/palette.css" />
  <link rel="stylesheet" href="../assets/css/light.css" />
  <script src="../assets/js/theme.js" defer></script>

  <style>
    body.mystic{margin:0;background:radial-gradient(circle at 50% 18%, var(--bg) 78%, #ece7dc 100%);color:var(--ink);font:18px/1.6 Georgia,"Iowan Old Style",serif}
    header,footer{max-width:1100px;margin:18px auto;background:var(--wash);border:1px solid var(--line);border-radius:12px;padding:14px 18px;text-align:center}
    header h1{margin:.2rem 0 .3rem;color:var(--accent)}
    .wrap{max-width:1100px;margin:0 auto;padding:10px 14px 24px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
    .cell{background:#ffffffcc;border:1px solid var(--line);border-radius:12px;padding:10px;cursor:pointer;transition:.2s}
    .cell:hover{background:var(--panel);transform:translateY(-1px)}
    .name{font-weight:bold;color:#3d3a34}
    .meta{font-size:.9rem;color:#6b6257}
    .plaque{margin-top:14px;font-size:.92rem;color:#6b6257;background:#fff;border:1px solid var(--line);border-radius:10px;padding:10px 12px}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
  </style>

  <script type="module">
    import { applyStylepack } from "../assets/js/style-engine.js";
    import { ensureAudio, loadIR, setBloomTone } from "../assets/js/bloom.js";

    async function loadAngels() {
      // IMPORTANT: this now points to your JSON data file in /assets/data/
      const res = await fetch("../assets/data/angels72.json", { cache: "no-cache" });
      const angels = await res.json();

      const grid = document.getElementById("angel-grid");
      const plaque = document.getElementById("plaque");
      const paletteHints = {
        Fire:"#e8893a", Air:"#8faef2", Water:"#80dfff", Earth:"#7aa36d", Light:"#f4c76a", Aether:"#c49bc7"
      };

      // prep audio (dry is fine if IR missing)
      ensureAudio(); loadIR("../assets/audio/ir/cathedral_small.wav");

      angels.forEach((a, idx) => {
        const cell = document.createElement("button");
        cell.className = "cell";
        cell.type = "button";
        cell.setAttribute("aria-label", `${a.name}: ${a.element}, ${a.toneHz} Hz`);
        cell.innerHTML = `
          <div class="name">${idx+1}. ${a.name}</div>
          <div class="meta">${a.sign ?? ""} ${a.decan ?? ""} · ${a.element} · ${a.toneHz} Hz</div>
          <div class="meta">Style: ${a.stylepack}</div>
        `;
        cell.addEventListener("click", () => {
          applyStylepack(a.stylepack);
          const color = paletteHints[a.element] || "#d4af37";
          setBloomTone(a.toneHz, { color, level: 0.18 });
          plaque.innerHTML = `
            <strong>Plaque -- Activation</strong><br/>
            Angel: <em>${a.name}</em> · ${a.sign ?? ""} ${a.decan ?? ""} · ${a.element}<br/>
            Tone: ${a.toneHz} Hz · Stylepack: <code>${a.stylepack}</code>${a.cymatic ? " · Pattern: "+a.cymatic : ""}
          `;
        });
        grid.appendChild(cell);
      });
    }

    window.addEventListener("DOMContentLoaded", loadAngels);
  </script>
</head>
<body class="mystic" data-theme="tiphereth">
  <header>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <div><a href="../cathedral.html">⟵ Back to Cathedral</a></div>
      <h1>72 Angelic Ladder</h1>
      <div><a href="./Thelemic-Alignment-Brief.html">Alignment Brief</a></div>
    </div>
    <p>Click any name to re‑skin the cathedral and sound a gentle harmonic bloom (ND‑safe).</p>
  </header>

  <div class="wrap">
    <div id="angel-grid" class="grid" role="list" aria-label="Shem ha-Mephorash angels"></div>
    <aside id="plaque" class="plaque" role="note" aria-label="Curator Plaque">
      <strong>Plaque -- Activation</strong><br/>Select an angel to view tone & style details here.
    </aside>
  </div>

  <footer>
    ❦ Green Man’s vine entwines; the Choir resounds. ❦<br>
    93 93/93 -- Stone Grimoire · Rosslyn Pattern
  </footer>
</body>
</html>