<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Cosmic Helix Renderer (Offline, ND-safe)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="color-scheme" content="light dark">
  <style>
    /* ND-safe styling: quiet contrast, no motion, centered breathing room */
    :root {
      --bg:#0b0b12;
      --ink:#e8e8f0;
      --muted:#a6a6c1;
    }

    html,
    body {
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--ink);
      font:15px/1.5 "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    }

    header {
      padding:16px 20px;
      border-bottom:1px solid rgba(255,255,255,0.08);
    }

    header strong {
      display:block;
      letter-spacing:0.08em;
      text-transform:uppercase;
      font-size:12px;
    }

    #status {
      margin-top:4px;
      color:var(--muted);
      font-size:13px;
    }

    main {
      padding:24px 16px 48px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
    }

    #stage {
      display:block;
      width:100%;
      max-width:1440px;
      height:auto;
      box-shadow:0 0 0 1px rgba(255,255,255,0.08);
      background:#080810;
    }

    .note {
      max-width:720px;
      color:var(--muted);
      text-align:center;
      font-size:14px;
    }

    code {
      background:rgba(255,255,255,0.05);
      padding:2px 4px;
      border-radius:3px;
    }
  </style>
</head>
<body>
  <header>
    <strong>Cosmic Helix Renderer</strong>
    <span id="status">Loading paletteâ€¦</span>
  </header>

  <main>
    <canvas id="stage" width="1440" height="900" aria-label="Layered sacred geometry canvas"></canvas>
    <p class="note">
      Layers paint once: Vesica grid, Tree-of-Life scaffold, Fibonacci curve, and static double-helix lattice.
      Everything runs offline with ND-safe colours and no animation.
    </p>
  </main>

  <script type="module">
    import { renderHelix } from "./js/helix-renderer.mjs";

    const statusEl = document.getElementById("status");
    const canvas = document.getElementById("stage");
    const ctx = canvas.getContext("2d");

    const FALLBACK = {
      bg:"#0b0b12",
      ink:"#e8e8f0",
      muted:"#a6a6c1",
      layers:["#8ba8ff","#74d8f2","#98f7c4","#ffd8a8","#f6b8ff","#d8dcff"]
    };

    const NUM = {
      THREE:3,
      SEVEN:7,
      NINE:9,
      ELEVEN:11,
      TWENTYTWO:22,
      THIRTYTHREE:33,
      NINETYNINE:99,
      ONEFORTYFOUR:144
    };

    async function readPalette(path) {
      try {
        const response = await fetch(path, { cache:"no-store" });
        if (!response.ok) throw new Error(String(response.status));
        return await response.json();
      } catch (error) {
        return null;
      }
    }

    function applyShellColours(palette) {
      document.documentElement.style.setProperty("--bg", palette.bg || FALLBACK.bg);
      document.documentElement.style.setProperty("--ink", palette.ink || FALLBACK.ink);
      document.documentElement.style.setProperty("--muted", palette.muted || FALLBACK.muted);
    }

    function isPalette(value) {
      return Boolean(value) && typeof value.bg === "string" && typeof value.ink === "string";
    }

    const palette = await readPalette("./data/palette.json");
    const activePalette = isPalette(palette) ? palette : FALLBACK;
    const paletteMessage = isPalette(palette)
      ? "Palette loaded."
      : "Palette missing or blocked; using safe fallback.";

    applyShellColours(activePalette);
    statusEl.textContent = paletteMessage;

    renderHelix(ctx, {
      width:canvas.width,
      height:canvas.height,
      palette:{
        bg:activePalette.bg,
        ink:activePalette.ink,
        layers:Array.isArray(activePalette.layers) ? activePalette.layers.slice() : FALLBACK.layers
      },
      NUM
    });
  </script>
</body>
</html>
