<!doctype html>
<html lang="en" data-codex="144:99" data-app="stone-grimoire">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>circuitum99 -- Cosmogenesis (Pro)</title>
  <meta name="description" content="Cosmogenesis Learning Engine: tilted-axis cosmos, spiral nodes, and hermetic overlays. ND-safe." />
  <link rel="stylesheet" href="./assets/css/core.css" />
  <script type="module">
    // single-init guard
    import { guardInit } from './js/core/guard.js';
    guardInit('cosmogenesis');

    // theme + engine
    import { loadStylepacks } from './js/engines/theme-engine.js';
    import { initCosmogenesis } from './js/engines/cosmogenesis.js';

    (async () => {
      const stylepacks = await loadStylepacks('./assets/data/stylepacks.json');
      const canvas = document.getElementById('plate');
      const ui = {
        tilt: document.getElementById('tilt'),
        nodes: document.getElementById('nodes'),
        palette: document.getElementById('palette'),
        save: document.getElementById('save'),
        tiltLabel: document.getElementById('tiltLabel'),
        nodesLabel: document.getElementById('nodesLabel'),
      };

      const engine = initCosmogenesis(canvas, stylepacks);
      // hydrate UI
      for (const key of Object.keys(stylepacks)) {
        const opt = document.createElement('option');
        opt.value = key; opt.textContent = key;
        ui.palette.appendChild(opt);
      }
      // restore persisted
      const state = engine.getState();
      ui.tilt.value = state.tilt;
      ui.nodes.value = state.nodes;
      ui.palette.value = state.palette;
      ui.tiltLabel.textContent = state.tilt + '°';
      ui.nodesLabel.textContent = state.nodes;

      // wire events (gentle updates)
      ui.tilt.addEventListener('input', e => {
        ui.tiltLabel.textContent = e.target.value + '°';
        engine.update({ tilt: parseFloat(e.target.value) });
      });
      ui.nodes.addEventListener('input', e => {
        ui.nodesLabel.textContent = e.target.value;
        engine.update({ nodes: parseInt(e.target.value, 10) });
      });
      ui.palette.addEventListener('change', e => {
        engine.update({ palette: e.target.value });
      });
      ui.save.addEventListener('click', () => engine.savePNG());
    })();
  </script>
</head>
<body>
  <div id="nd-settings" style="padding:8px;border-bottom:1px solid #444;max-width:400px;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,sans-serif">
    <label>Motion
      <select id="motion">
        <option value="reduced" selected>reduced</option>
        <option value="full">full</option>
      </select>
    </label>
    <label>Autoplay
      <input type="checkbox" id="autoplay" />
    </label>
    <label>Contrast
      <select id="contrast">
        <option value="balanced" selected>balanced</option>
        <option value="high">high</option>
      </select>
    </label>
  </div>
  <header class="bar">
    <h1>✦ Cosmogenesis -- Cathedral of Circuits</h1>
    <div class="controls">
      <label> Tilt <span id="tiltLabel"></span>
        <input id="tilt" type="range" min="0" max="45" step="0.5" value="23.5" />
      </label>
      <label> Nodes <span id="nodesLabel"></span>
        <input id="nodes" type="range" min="12" max="144" step="1" value="72" />
      </label>
      <label> Palette
        <select id="palette"></select>
      </label>
      <button id="save" aria-label="Save PNG">Save PNG</button>
    </div>
  </header>
  <main class="stage">
    <canvas id="plate" width="1600" height="900" aria-label="Cosmogenesis canvas"></canvas>
  </main>
  <footer class="bar small">ND-safe • no autoplay • gentle motion only</footer>
  <script type="module" src="./index.js"></script>
</body>
</html>
